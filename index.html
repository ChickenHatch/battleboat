<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
<!--
Normally I would put the HTML, CSS, and JS in three separate
files but the application question implies that you guys want
everything in one file, so I'm putting everything into one file.
-->
	<title>Battleboat</title>
	<style>
	@import url(http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700);
	html, body {
		width: 100%;
		padding: 0;
		margin: 0;
		background-color: #ddd;
	}
	h1, h2, h3, h4, h5, h6, p {
		font-family: 'Open Sans', Helvetica, Arial, sans-serif;
		color: #222;
	}
	a {
		color: #222;
		font-weight: bold;
	}
		a:hover {
			text-decoration: none;
		}
	div {
		padding: 0;
		margin: 0;
	}
	.container {
		width: 520px;
		text-align: center;
		margin: 20px auto 100px auto;
	}
	.ammo-counter {
		font-weight: bold;
	}
	.grid {
		padding: 5px;
		height: 520px;
		width: 520px;
		background-color: #25567B;
		-webkit-border-radius: 5px;
		-moz-border-radius: 5px;
		border-radius: 5px;
	}
		.grid-cell {
			vertical-align: top; /*clears the vertical space between rows*/
			height: 50px;
			width: 50px;
			display: inline-block;
			background-color: #66A3D2;
			margin: 1px;
			-webkit-border-radius: 2px;
			-moz-border-radius: 2px;
			border-radius: 2px;
		}
			.grid-cell:hover {
				cursor: pointer;
				background-color: #7EB3DA;
			}

		.grid-ship {
			background-color: #C0C0C0;
		}
		.grid-miss, .grid-miss:hover {
			background-color: white;
		}
		.grid-hit, .grid-hit:hover {
			background-color: #F60018;
		}
		.grid-sunk, .grid-sunk:hover {
			background-color: black;
		}
	</style>
</head>
<body>
<div class="container">
	<h1>Battleboat</h1>
	<p>A simple HTML5 battleship clone</p>
	<p>Click on the cells below to find and destroy all five enemy ships
	<br>You have <span class="ammo-counter">60</span> shots remaining</p>
	<!-- Whitespace needs to be commented out due to the browser bug that creates spaces between the divs -->
	<div class="grid"><!--
		--><div data-x="0" data-y="0" class="grid-cell grid-cell-0-0"></div><!--
		--><div data-x="0" data-y="1" class="grid-cell grid-cell-0-1"></div><!--
		--><div data-x="0" data-y="2" class="grid-cell grid-cell-0-2"></div><!--
		--><div data-x="0" data-y="3" class="grid-cell grid-cell-0-3"></div><!--
		--><div data-x="0" data-y="4" class="grid-cell grid-cell-0-4"></div><!--
		--><div data-x="0" data-y="5" class="grid-cell grid-cell-0-5"></div><!--
		--><div data-x="0" data-y="6" class="grid-cell grid-cell-0-6"></div><!--
		--><div data-x="0" data-y="7" class="grid-cell grid-cell-0-7"></div><!--
		--><div data-x="0" data-y="8" class="grid-cell grid-cell-0-8"></div><!--
		--><div data-x="0" data-y="9" class="grid-cell grid-cell-0-9"></div><!--
		--><div data-x="1" data-y="0" class="grid-cell grid-cell-1-0"></div><!--
		--><div data-x="1" data-y="1" class="grid-cell grid-cell-1-1"></div><!--
		--><div data-x="1" data-y="2" class="grid-cell grid-cell-1-2"></div><!--
		--><div data-x="1" data-y="3" class="grid-cell grid-cell-1-3"></div><!--
		--><div data-x="1" data-y="4" class="grid-cell grid-cell-1-4"></div><!--
		--><div data-x="1" data-y="5" class="grid-cell grid-cell-1-5"></div><!--
		--><div data-x="1" data-y="6" class="grid-cell grid-cell-1-6"></div><!--
		--><div data-x="1" data-y="7" class="grid-cell grid-cell-1-7"></div><!--
		--><div data-x="1" data-y="8" class="grid-cell grid-cell-1-8"></div><!--
		--><div data-x="1" data-y="9" class="grid-cell grid-cell-1-9"></div><!--
		--><div data-x="2" data-y="0" class="grid-cell grid-cell-2-0"></div><!--
		--><div data-x="2" data-y="1" class="grid-cell grid-cell-2-1"></div><!--
		--><div data-x="2" data-y="2" class="grid-cell grid-cell-2-2"></div><!--
		--><div data-x="2" data-y="3" class="grid-cell grid-cell-2-3"></div><!--
		--><div data-x="2" data-y="4" class="grid-cell grid-cell-2-4"></div><!--
		--><div data-x="2" data-y="5" class="grid-cell grid-cell-2-5"></div><!--
		--><div data-x="2" data-y="6" class="grid-cell grid-cell-2-6"></div><!--
		--><div data-x="2" data-y="7" class="grid-cell grid-cell-2-7"></div><!--
		--><div data-x="2" data-y="8" class="grid-cell grid-cell-2-8"></div><!--
		--><div data-x="2" data-y="9" class="grid-cell grid-cell-2-9"></div><!--
		--><div data-x="3" data-y="0" class="grid-cell grid-cell-3-0"></div><!--
		--><div data-x="3" data-y="1" class="grid-cell grid-cell-3-1"></div><!--
		--><div data-x="3" data-y="2" class="grid-cell grid-cell-3-2"></div><!--
		--><div data-x="3" data-y="3" class="grid-cell grid-cell-3-3"></div><!--
		--><div data-x="3" data-y="4" class="grid-cell grid-cell-3-4"></div><!--
		--><div data-x="3" data-y="5" class="grid-cell grid-cell-3-5"></div><!--
		--><div data-x="3" data-y="6" class="grid-cell grid-cell-3-6"></div><!--
		--><div data-x="3" data-y="7" class="grid-cell grid-cell-3-7"></div><!--
		--><div data-x="3" data-y="8" class="grid-cell grid-cell-3-8"></div><!--
		--><div data-x="3" data-y="9" class="grid-cell grid-cell-3-9"></div><!--
		--><div data-x="4" data-y="0" class="grid-cell grid-cell-4-0"></div><!--
		--><div data-x="4" data-y="1" class="grid-cell grid-cell-4-1"></div><!--
		--><div data-x="4" data-y="2" class="grid-cell grid-cell-4-2"></div><!--
		--><div data-x="4" data-y="3" class="grid-cell grid-cell-4-3"></div><!--
		--><div data-x="4" data-y="4" class="grid-cell grid-cell-4-4"></div><!--
		--><div data-x="4" data-y="5" class="grid-cell grid-cell-4-5"></div><!--
		--><div data-x="4" data-y="6" class="grid-cell grid-cell-4-6"></div><!--
		--><div data-x="4" data-y="7" class="grid-cell grid-cell-4-7"></div><!--
		--><div data-x="4" data-y="8" class="grid-cell grid-cell-4-8"></div><!--
		--><div data-x="4" data-y="9" class="grid-cell grid-cell-4-9"></div><!--
		--><div data-x="5" data-y="0" class="grid-cell grid-cell-5-0"></div><!--
		--><div data-x="5" data-y="1" class="grid-cell grid-cell-5-1"></div><!--
		--><div data-x="5" data-y="2" class="grid-cell grid-cell-5-2"></div><!--
		--><div data-x="5" data-y="3" class="grid-cell grid-cell-5-3"></div><!--
		--><div data-x="5" data-y="4" class="grid-cell grid-cell-5-4"></div><!--
		--><div data-x="5" data-y="5" class="grid-cell grid-cell-5-5"></div><!--
		--><div data-x="5" data-y="6" class="grid-cell grid-cell-5-6"></div><!--
		--><div data-x="5" data-y="7" class="grid-cell grid-cell-5-7"></div><!--
		--><div data-x="5" data-y="8" class="grid-cell grid-cell-5-8"></div><!--
		--><div data-x="5" data-y="9" class="grid-cell grid-cell-5-9"></div><!--
		--><div data-x="6" data-y="0" class="grid-cell grid-cell-6-0"></div><!--
		--><div data-x="6" data-y="1" class="grid-cell grid-cell-6-1"></div><!--
		--><div data-x="6" data-y="2" class="grid-cell grid-cell-6-2"></div><!--
		--><div data-x="6" data-y="3" class="grid-cell grid-cell-6-3"></div><!--
		--><div data-x="6" data-y="4" class="grid-cell grid-cell-6-4"></div><!--
		--><div data-x="6" data-y="5" class="grid-cell grid-cell-6-5"></div><!--
		--><div data-x="6" data-y="6" class="grid-cell grid-cell-6-6"></div><!--
		--><div data-x="6" data-y="7" class="grid-cell grid-cell-6-7"></div><!--
		--><div data-x="6" data-y="8" class="grid-cell grid-cell-6-8"></div><!--
		--><div data-x="6" data-y="9" class="grid-cell grid-cell-6-9"></div><!--
		--><div data-x="7" data-y="0" class="grid-cell grid-cell-7-0"></div><!--
		--><div data-x="7" data-y="1" class="grid-cell grid-cell-7-1"></div><!--
		--><div data-x="7" data-y="2" class="grid-cell grid-cell-7-2"></div><!--
		--><div data-x="7" data-y="3" class="grid-cell grid-cell-7-3"></div><!--
		--><div data-x="7" data-y="4" class="grid-cell grid-cell-7-4"></div><!--
		--><div data-x="7" data-y="5" class="grid-cell grid-cell-7-5"></div><!--
		--><div data-x="7" data-y="6" class="grid-cell grid-cell-7-6"></div><!--
		--><div data-x="7" data-y="7" class="grid-cell grid-cell-7-7"></div><!--
		--><div data-x="7" data-y="8" class="grid-cell grid-cell-7-8"></div><!--
		--><div data-x="7" data-y="9" class="grid-cell grid-cell-7-9"></div><!--
		--><div data-x="8" data-y="0" class="grid-cell grid-cell-8-0"></div><!--
		--><div data-x="8" data-y="1" class="grid-cell grid-cell-8-1"></div><!--
		--><div data-x="8" data-y="2" class="grid-cell grid-cell-8-2"></div><!--
		--><div data-x="8" data-y="3" class="grid-cell grid-cell-8-3"></div><!--
		--><div data-x="8" data-y="4" class="grid-cell grid-cell-8-4"></div><!--
		--><div data-x="8" data-y="5" class="grid-cell grid-cell-8-5"></div><!--
		--><div data-x="8" data-y="6" class="grid-cell grid-cell-8-6"></div><!--
		--><div data-x="8" data-y="7" class="grid-cell grid-cell-8-7"></div><!--
		--><div data-x="8" data-y="8" class="grid-cell grid-cell-8-8"></div><!--
		--><div data-x="8" data-y="9" class="grid-cell grid-cell-8-9"></div><!--
		--><div data-x="9" data-y="0" class="grid-cell grid-cell-9-0"></div><!--
		--><div data-x="9" data-y="1" class="grid-cell grid-cell-9-1"></div><!--
		--><div data-x="9" data-y="2" class="grid-cell grid-cell-9-2"></div><!--
		--><div data-x="9" data-y="3" class="grid-cell grid-cell-9-3"></div><!--
		--><div data-x="9" data-y="4" class="grid-cell grid-cell-9-4"></div><!--
		--><div data-x="9" data-y="5" class="grid-cell grid-cell-9-5"></div><!--
		--><div data-x="9" data-y="6" class="grid-cell grid-cell-9-6"></div><!--
		--><div data-x="9" data-y="7" class="grid-cell grid-cell-9-7"></div><!--
		--><div data-x="9" data-y="8" class="grid-cell grid-cell-9-8"></div><!--
		--><div data-x="9" data-y="9" class="grid-cell grid-cell-9-9"></div><!--
	--></div>
	<p>Created by <a href="http://www.kortaggio.com">Bill Mei</a>.</p>
	<p>This project is open-source on GitHub: <a href="https://github.com/kortaggio/battleboat">https://github.com/kortaggio/battleboat</a></p>
</div>

<script>
(function() {
	// Battleboat
	// Bill Mei, 2014
	// MIT License

	// This is one-player for now which means you don't get to place
	// your own ships yet but I'm going to update that later.
	// Currently the computer just places ships at random and you
	// have to guess where they are but eventually I want to
	// implement an AI based on the DataGenetics algorithm:
	// http://www.datagenetics.com/blog/december32011/

	// I know this isn't the greatest OO code since I didn't know how to
	// avoid using a few global variables but that's why I'm applying to
	// Hacker School, so I can learn how to write better code!
	var AVAILABLE_SHIPS = ['carrier', 'battleship', 'destroyer', 'submarine', 'speedboat'];

	// Game manager object
	function Game(size, numShips) {
		this.size = size;
		this.numShips = numShips;
		this.gameWon = false;
		this.shotsTaken = 0;
		this.maxAllowedShots = 60; // You lose if you take more shots than this
		this.initialize();
	}
	Game.prototype.updateShots = function() {
		this.shotsTaken++;
		var ammoRemaining = this.maxAllowedShots - this.shotsTaken;
		document.querySelector('.ammo-counter').textContent = ammoRemaining;

		// check if you've won or not
		if (this.shotsTaken >= this.maxAllowedShots) {
			alert('Yarr! You ran out of ammo. Try again.');
			this.resetFogOfWar();
			this.initialize();
		} else {
			if (this.player0fleet.allShipsSunk()) {
				this.gameWon = true;
				alert('Congratulations, you win!');
				this.resetFogOfWar();
				this.initialize();
			}
		}
	};
	Game.prototype.shoot = function(x, y) {
		var playerGrid = this.player0grid;
		var playerFleet = this.player0fleet;

		if (playerGrid.containsDamagedShip(x, y)) {
			// Do nothing
		} else if (playerGrid.containsCannonball(x, y)) {
			// Do nothing
		} else if (playerGrid.containsUndamagedShip(x, y)) {
			playerFleet.findShipByLocation(x, y).incrementDamage();
			// update the board/grid
			playerGrid.updateCell(x, y, 'hit');
			this.updateShots();
		} else {
			playerGrid.updateCell(x, y, 'miss');
			this.updateShots();
		}

	};
	Game.prototype.clickListener = function(e) {
		// extract coordinates from event listener
		var x = parseInt(e.target.getAttribute('data-x'), 10);
		var y = parseInt(e.target.getAttribute('data-y'), 10);

		mainGame.shoot(x, y);
	}
	Game.prototype.resetFogOfWar = function() {
		for (var i = 0; i < this.size; i++) {
			for (var j = 0; j < this.size; j++) {
				this.player0grid.updateCell(i, j, 'empty');
			}
		}
	};
	Game.prototype.initialize = function() {
		// You are player 0 and the computer is player 1
		this.player0grid = new Grid(0, this.size);
		// this.player1grid = new Grid(1, this.size);

		this.player0fleet = new Fleet(0, this.numShips, this);
		// this.player1fleet = new Fleet(1, this.numShips, this);

		// Reset game variables
		this.shotsTaken = 0;
		this.gameWon = false;
		// add a click listener for the Grid.shoot() method for all cells
		var gridContainer = document.querySelector('.grid');
		var gridCells = gridContainer.childNodes;
		for (var i = 0; i < gridCells.length; i++) {
			gridCells[i].addEventListener('click', this.clickListener, false);
		}
		this.player0fleet.placeShipsRandomly();
		document.querySelector('.ammo-counter').textContent = this.maxAllowedShots;
	};

	// Grid object
	function Grid(player, size) {
		// Grid code:
		// 0 = water (empty)
		// 1 = undamaged ship
		// 2 = water with a cannonball in it (missed shot)
		// 3 = damaged ship (hit shot)
		// 4 = sunk ship
		this.size = size;
		this.cells = [];
		this.initialize();
	}
	Grid.prototype.initialize = function() {
		for (var x = 0; x < this.size; x++) {
			var row = [];
			this.cells[x] = row;
			for (var y = 0; y < this.size; y++) {
				row.push(0)
			}
		}
	};
	Grid.prototype.updateCell = function(x, y, type) {
		// Possible values for the parameter `type`  (string) can be:
		// empty
		// ship
		// miss
		// hit
		// sunk
		switch (type) {
			case 'empty':
				this.cells[x][y] = 0;
				break;
			case 'ship':
				this.cells[x][y] = 1;
				break;
			case 'miss':
				this.cells[x][y] = 2;
				break;
			case 'hit':
				this.cells[x][y] = 3;
				break;
			case 'sunk':
				this.cells[x][y] = 4;
				break;
			default:
				this.cells[x][y] = 0;
				break;
		}
		var classes = ['grid-cell', 'grid-cell-' + x + '-' + y, 'grid-' + type]
		document.querySelector('.grid-cell-' + x + '-' + y).setAttribute('class', classes.join(' '))
	};
	Grid.prototype.containsUndamagedShip = function(x, y) {
		if (this.cells[x][y] === 1) {
			return true;
		} else {
			return false;
		}
	};
	Grid.prototype.containsCannonball = function(x, y) {
		if (this.cells[x][y] === 2) {
			return true;
		} else {
			return false;
		}
	};
	Grid.prototype.containsDamagedShip = function(x, y) {
		if (this.cells[x][y] === 3 || this.cells[x][y] === 4) {
			return true;
		} else {
			return false;
		}
	};

	// Fleet object
	function Fleet(player, numShips, gameObject) {
		this.player = player;
		this.numShips = numShips;
		this.gameObject = gameObject;
		this.fleetRoster = [];
		this.populate();
	}
	Fleet.prototype.populate = function() {
		for (var i = 0; i < this.numShips; i++) {
			// loop over the ship types when numShips > AVAILABLE_SHIPS.length
			var j = i % AVAILABLE_SHIPS.length;
			this.fleetRoster.push(new Ship(AVAILABLE_SHIPS[j], this.gameObject));
		}
	};
	Fleet.prototype.placeShipsRandomly = function() {
		for (var i = 0; i < this.fleetRoster.length; i++) {
			var illegalPlacement = true;
			while (illegalPlacement) {
				var randomX = Math.floor(10*Math.random());
				var randomY = Math.floor(10*Math.random());
				var randomDirection = Math.floor(2*Math.random());
				if (this.fleetRoster[i].isLegal(randomX, randomY, randomDirection)) {
					this.fleetRoster[i].create(randomX, randomY, randomDirection);
					illegalPlacement = false;
				} else {
					continue;
				}
			}
		}
	};
	Fleet.prototype.findShipByLocation = function(x, y) {
		// Returns the ship object located at (x, y)
		// If no ship exists at (x, y), this returns null.
		for (var i = 0; i < this.fleetRoster.length; i++) {
			var currentShip = this.fleetRoster[i];
			if (currentShip.direction === 0) {
				if (y === currentShip.yPosition &&
					x >= currentShip.xPosition &&
					x <= currentShip.xPosition + currentShip.shipLength) {
					return currentShip;
				} else {
					continue;
				}
			} else {
				if (x === currentShip.xPosition &&
					y >= currentShip.yPosition &&
					y <= currentShip.yPosition + currentShip.shipLength) {
					return currentShip;
				} else {
					continue;
				}
			}
		}
		return null;
	};
	Fleet.prototype.allShipsSunk = function() {
		for (var i = 0; i < this.fleetRoster.length; i++) {
			// If one or more ships are not sunk, then the sentence "all ships are sunk" is false.
			if (this.fleetRoster[i].sunk === false) {
				return false;
			}
		}
		return true;
	};

	// Ship object
	function Ship(type, gameObject) {
		this.damage = 0;
		this.gameObject = gameObject;
		this.type = type;
		switch (this.type) {
			case AVAILABLE_SHIPS[0]:
				this.shipLength = 5;
				break;
			case AVAILABLE_SHIPS[1]:
				this.shipLength = 4;
				break;
			case AVAILABLE_SHIPS[2]:
				this.shipLength = 3;
				break;
			case AVAILABLE_SHIPS[3]:
				this.shipLength = 3;
				break;
			case AVAILABLE_SHIPS[4]:
				this.shipLength = 2;
				break;
			default:
				this.shipLength = 1;
				break;
		}
		this.maxDamage = this.shipLength;
		this.sunk = false;
	}
	Ship.prototype.isLegal = function(x, y, direction) {
		// first, check if the ship is within the grid...
		if (this.withinBounds(x, y, direction)) {
			// ...then check to make sure it doesn't collide with another ship
			for (var i = 0; i < this.shipLength; i++) {
				if (direction === 0) {
					if (this.gameObject.player0grid.cells[x + i][y] === 1) {
						return false;
					}
				} else {
					if (this.gameObject.player0grid.cells[x][y + i] === 1) {
						return false;
					}
				}
			}
			return true;
		} else {
			return false;
		}
	};
	Ship.prototype.withinBounds = function(x, y, direction) {
		if (direction === 0) {
			return x + this.shipLength <= this.gameObject.size;
		} else {
			return y + this.shipLength <= this.gameObject.size;
		}
	};
	Ship.prototype.incrementDamage = function() {
		this.damage++;
		if (this.isSunk()) {
			this.sunk = true;
		}
		return this; // Returns back the ship object so that I can chain the method calls in Game.shoot()
	};
	Ship.prototype.isSunk = function() {
		return this.damage >= this.maxDamage;
	};
	Ship.prototype.getAllShipCells = function() {
	// returns a zero-indexed JSON with all (x, y) coordinates of the ship:
	// e.g.
	// {
	// 	0:{'x':2, 'y':2},
	// 	1:{'x':3, 'y':2},
	// 	2:{'x':4, 'y':2}
	// }
		var resultObject = {};
		for (var i = 0; i < this.shipLength; i++) {
			if (this.direction === 0) {
				resultObject[i] = {'x':this.xPosition + i, 'y':this.yPosition};
			} else {
				resultObject[i] = {'x':this.xPosition, 'y':this.yPosition + i};
			}
		}
		return resultObject;
	};
	Ship.prototype.create = function(x, y, direction) {
		// This function assumes that you've already checked that the placement is legal
		this.xPosition = x;
		this.yPosition = y;
		this.direction = direction;
		// direction === 0 when the ship is facing north/south
		// direction === 1 when the ship is facing east/west
		for (var i = 0; i < this.shipLength; i++) {
			if (this.direction === 0) {
				this.gameObject.player0grid.cells[x + i][y] = 1;
			} else {
				this.gameObject.player0grid.cells[x][y + i] = 1;
			}
		}
	};

	var mainGame = new Game(10, 5);
})();
</script>
</body>
</html>